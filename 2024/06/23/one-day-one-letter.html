<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>one day one letter - wanictf 2024 | shafouz blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="one day one letter - wanictf 2024" />
<meta name="author" content="shafouz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="https://ctftime.org/event/2377" />
<meta property="og:description" content="https://ctftime.org/event/2377" />
<link rel="canonical" href="https://shafouz.github.io/2024/06/23/one-day-one-letter.html" />
<meta property="og:url" content="https://shafouz.github.io/2024/06/23/one-day-one-letter.html" />
<meta property="og:site_name" content="shafouz blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-23T04:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="one day one letter - wanictf 2024" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"shafouz"},"dateModified":"2024-06-23T04:00:00+00:00","datePublished":"2024-06-23T04:00:00+00:00","description":"https://ctftime.org/event/2377","headline":"one day one letter - wanictf 2024","mainEntityOfPage":{"@type":"WebPage","@id":"https://shafouz.github.io/2024/06/23/one-day-one-letter.html"},"url":"https://shafouz.github.io/2024/06/23/one-day-one-letter.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://shafouz.github.io/feed.xml" title="shafouz blog" />
<!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-F6L4J94HSJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-F6L4J94HSJ');
  </script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">shafouz blog</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">one day one letter - wanictf 2024</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-06-23T04:00:00+00:00" itemprop="datePublished">
        Jun 23, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>https://ctftime.org/event/2377</p>

<h1 id="one-day-one-letter-web">one-day-one-letter (web)</h1>

<p>The challenge consists of two servers, one that display some content and one that host both
the private and public keys.
The server doesnt validade the “timeserver” parameter though so we can just create our own pair of keys
and point to our server.</p>

<h2 id="solution">Solution</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">ECC</span>
<span class="kn">from</span> <span class="nn">Crypto.Signature</span> <span class="kn">import</span> <span class="n">DSS</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># gen key
# key = ECC.generate(curve='p256')
# open("key.txt", "w").write(key.export_key(format='PEM'))
# pubkey = key.public_key().export_key(format='PEM')
# open("pub.txt", "w").write(pubkey)
# host with whatever
</span>
<span class="n">REMOTE</span> <span class="o">=</span> <span class="s">"https://web-one-day-one-letter-content-lz56g6.wanictf.org/"</span>

<span class="k">def</span> <span class="nf">make_body</span><span class="p">(</span><span class="n">adjust</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"key.txt"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="n">adjust</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">SHA256</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">ECC</span><span class="p">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">signer</span> <span class="o">=</span> <span class="n">DSS</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">"fips-186-3"</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">signer</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span>
    <span class="n">timestamp</span><span class="p">,</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">make_body</span><span class="p">(</span><span class="o">-</span><span class="mi">90000</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> 

    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">REMOTE</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"timestamp"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span>
            <span class="s">"signature"</span><span class="p">:</span> <span class="n">signature</span><span class="p">.</span><span class="nb">hex</span><span class="p">(),</span>
            <span class="s">"timeserver"</span><span class="p">:</span> <span class="s">"&lt;hostname&gt;"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"DEBUGPRINT[1]: solve.py:27: res.text=</span><span class="si">{</span><span class="n">res</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="flag">Flag</h2>
<p><code class="language-plaintext highlighter-rouge">FLAG{lyingthetime}</code></p>

<p>shafouz 2024/06/23</p>

  </div><a class="u-url" href="/2024/06/23/one-day-one-letter.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://shafouz.github.io/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">shafouz</li>
          <li><a class="u-email" href="mailto:jlmacedomatos@gmail.com">contact</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://hackerone.com/shafou" target="_blank" title="hackerone">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#hackerone"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/shafouz" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/shafouzzzzzz" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/joao-luca/" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
